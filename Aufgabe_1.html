<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Aufgabe 1</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
      crossorigin="anonymous"
    />
  </head>

  <body>
    <div class="container main mt-5">
      <div class="card mx-auto" style="min-width: 800px; max-width: 800px">
        <div class="card-header">
          <div class="d-flex flex-row justify-content-center">
            <div class="flex-grow-1 text-center draw-title">Test</div>
            <span class="btn-close" onclick="closeAndEnd()"></span>
          </div>
        </div>
        <div class="card-body">
          <div
            class="radio-top d-flex flex-row justify-content-around border rounded-2 p-2"
          >
            <div class="form-check">
              <input
                type="radio"
                name="option"
                id="rectangle"
                oninput="toggleDrawing(this)"
                checked
              />
              <label class="" for="option">Rechteck</label>
            </div>
            <div class="form-check">
              <input
                type="radio"
                name="option"
                id="triangle"
                oninput="toggleDrawing(this)"
              />
              <label class="" for="option">Dreieck</label>
            </div>
            <div class="form-check">
              <input
                type="radio"
                name="option"
                id="circle"
                oninput="toggleDrawing(this)"
              />
              <label class="" for="option">Kreis</label>
            </div>
          </div>
          <div class="math-center">
            <div class="row">
              <div class="col p-2" style="min-height: 250px">
                <div class="draw-image">
                  <img class="img-fluid draw-img" src="" />
                  <div class="draw-img-calc">
                    <p></p>
                  </div>
                </div>
                <div class="draw-image-info">
                  <p></p>
                </div>
              </div>
              <div class="col p-2" style="min-width: 300px">
                <!-- Rechteck -->
                <div class="rectangle-col draw-col">
                  <!-- <div class="h4 text-center">Rechteck</div> -->
                  <div class="mb-3 row">
                    <label class="col-form-label col-sm-3">A</label>
                    <div class="col-sm-9">
                      <input
                        class="form-control rectangle-col-a"
                        type="text"
                        onblur="checkvalidInput(this)"
                      />
                    </div>
                  </div>
                  <div class="mb-3 row">
                    <label class="col-form-label col-sm-3">B</label>
                    <div class="col-sm-9">
                      <input
                        class="form-control rectangle-col-b"
                        type="text"
                        onblur="checkvalidInput(this)"
                      />
                    </div>
                  </div>
                  <div class="mb-3 row">
                    <label class="col-form-label col-sm-3">Fläche</label>
                    <div class="col-sm-9">
                      <input
                        class="form-control rectangle-col-result"
                        readonly
                        type="text"
                      />
                    </div>
                  </div>
                </div>
                <!-- Dreieck -->
                <div class="triangle-col draw-col">
                  <!-- <div class="h4 text-center">Dreieck</div> -->
                  <div class="mb-3 row">
                    <label class="col-form-label col-sm-3">A</label>
                    <div class="col-sm-9">
                      <input
                        class="form-control triangle-col-a"
                        type="text"
                        onblur="checkvalidInput(this)"
                      />
                    </div>
                  </div>
                  <div class="mb-3 row">
                    <label class="col-form-label col-sm-3">B</label>
                    <div class="col-sm-9">
                      <input
                        class="form-control triangle-col-b"
                        type="text"
                        onblur="checkvalidInput(this)"
                      />
                    </div>
                  </div>
                  <div class="mb-3 row">
                    <label class="col-form-label col-sm-3">Fläche</label>
                    <div class="col-sm-9">
                      <input
                        class="form-control triangle-col-result"
                        type="text"
                        readonly
                      />
                    </div>
                  </div>
                </div>
                <!-- Kreis -->
                <div class="circle-col draw-col">
                  <!-- <div class="h4 text-center">Kreis</div> -->
                  <div class="mb-3 row">
                    <label class="col-form-label col-sm-3">r</label>
                    <div class="col-sm-9">
                      <input
                        class="form-control circle-col-r"
                        type="text"
                        onblur="checkvalidInput(this)"
                      />
                    </div>
                  </div>
                  <!-- <div class="mb-3 row">
                    <label class="col-form-label col-sm-3">B</label>
                    <div class="col-sm-9">
                      <input class="form-control" type="text" />
                    </div>
                  </div> -->
                  <div class="mb-3 row">
                    <label class="col-form-label col-sm-3">Fläche</label>
                    <div class="col-sm-9">
                      <input
                        class="form-control circle-col-result"
                        type="text"
                        readonly
                      />
                    </div>
                  </div>
                </div>
              </div>
              <div class="col p-2">
                <div
                  class="radio-calculation d-flex flex-column justify-content-around border rounded-2 mx-1 p-3"
                >
                  <div class="form-check">
                    <input
                      type="radio"
                      name="calculation"
                      id="scope"
                      oninput="calculationSelected(this)"
                      checked
                    />
                    <label class="" for="scope">Flächeninhalt</label>
                  </div>
                  <div class="form-check">
                    <input
                      type="radio"
                      name="calculation"
                      id="surface"
                      oninput="calculationSelected(this)"
                    />
                    <label class="" for="surface">Umfang</label>
                  </div>
                </div>
              </div>
            </div>
            <div class="button-row input-group justify-content-end">
              <button class="btn btn-outline-secondary calculationButton" onclick="calc()">
                Berechnen
              </button>
              <button class="btn btn-outline-secondary" onclick="closeAndEnd()">
                Beenden
              </button>
            </div>
          </div>
        </div>
      </div>
      <script
        src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
        crossorigin="anonymous"
      ></script>
      <script type="text/javascript">
        log("onload");
        const RECT = "rectangle";
        const TRI = "triangle";
        const CIR = "circle";
        const SCOPE = "scope";
        const SUR = "surface";
        const RECT_SCOPE_TEXT = "Flächeninhalt = a * b";
        const RECT_SUR_TEXT = "Umfang = 2* (a + b)";
        const TRI_SCOPE_TEXT = "Flächeninhalt = a * b / 2";
        const TRI_SUR_TEXT = "Umfang =  √(a² + b²) + a + b";
        const CIR_SCOPE_TEXT = "Flächeninhalt = π/4 * 2r²";
        const CIR_SUR_TEXT = "Umfang = 2 * r * π";
        setUpCalculation("rectangle");

        // console.log helper
        function log(logMessage = "") {
          console.log(logMessage);
        }
        // set title
        function setTitle(title = null, imageText = null) {
          let drawTitle = document.querySelector(".draw-title");
          if (drawTitle != null) {
            drawTitle.innerHTML = title || "Keine Auswahl";
          }
          setImageText(imageText);
        }
        function setImageText(imageText = null) {
          let imgDrawText = document.querySelector(".draw-img-calc p");
          if (imgDrawText != null) {
            imgDrawText.innerHTML = imageText;
          }
        }
        function checkvalidInput(element) {
          log("check input for valid number");
          log(isNaN(element.value));
          if (!isPositiveInteger2(element.value)) {
            element.classList.add("is-invalid");
          } else {
            element.classList.remove("is-invalid");
          }
          toggleCalculationButtonOnValidation();
        }
        function removeValidation() {
          const invalid = document.querySelectorAll('.is-invalid');
          if(invalid != null && invalid.length > 0) {
            invalid.forEach((elem) => elem.classList.remove("is-invalid"));
          }
          toggleCalculationButtonOnValidation();
        }
        function toggleCalculationButtonOnValidation() {
          const invalid = document.querySelectorAll('.is-invalid');
          const btn = document.querySelector('.calculationButton');
          if(invalid != null && invalid.length > 0) {
            log(invalid);
            btn.setAttribute("disabled",true);
          } else {
            btn.removeAttribute("disabled");
          }
        }
        function isPositiveInteger2(v) {
          var i;
          return v && (i = parseInt(v)) && i > 0 && (i === v || ''+i === v);
        }
        function isPositiveInteger(n) {
          return 0 === n % (!isNaN(parseFloat(n)) && 0 <= ~~n) && Number(n) > 0;
        }
        /**
         * on the calculation radio is toggled
         */
        function calculationSelected(event_id) {
          log("calculation selected for event id " + event_id.id);
          const selectedForm = document.querySelector(".radio-top :checked");
          let drawText = "";
          switch (selectedForm.id) {
            case RECT:
              drawText = event_id.id == SCOPE ? RECT_SCOPE_TEXT : RECT_SUR_TEXT;
              break;
            case TRI:
              drawText = event_id.id == SCOPE ? TRI_SCOPE_TEXT : TRI_SUR_TEXT;
              break;
            case CIR:
              drawText = event_id.id == SCOPE ? CIR_SCOPE_TEXT : CIR_SUR_TEXT;
              break;
            default:
              return;
          }
          setImageText(drawText);
          calc();
        }
        // functions which closes and cleans
        function closeAndEnd() {
          defaultRadioInputs();
          setUpCalculation("rectangle");
        }
        // set default radio inputs
        function defaultRadioInputs() {
          selectRadioInput(document.querySelector(".radio-top #rectangle"));
          selectRadioInput(document.querySelector(".radio-calculation #scope"));
        }
        function selectRadioInput(radio) {
          if (radio != null) {
            radio.checked = true;
          }
        }
        // toggle the drawing on event
        function toggleDrawing(event) {
          if (event != null) {
            setUpCalculation(event.id);
          }
        }
        // hide the image
        function toggleDrawImage(display = "none") {
          let img = document.querySelector(".draw-image");
          if (img != null) {
            img.style.display = display;
          }
        }
        /**
         *  hide the draw column
         */
        function hideDrawCols() {
          let drawCols = document.querySelectorAll(".draw-col");
          if (drawCols != null) {
            drawCols.forEach((col) => (col.style.display = "none"));
          }
        }
        /**
         * reset input to number 0
         */
        function resetInputNumberFields(fields) {
          if (fields != null) {
            fields.forEach((elem) => (elem.value = 0));
          }
        }
        /**
         * setup calculation based on radio button selection
         * @value event_id
         */
        function setUpCalculation(event_id) {
          hideDrawCols();
          selectRadioInput(document.querySelector(".radio-calculation #scope"));
          removeValidation();
          let drawCol = null;
          let rootImg = null;
          let imgDrawText = null;
          let title = null;
          switch (event_id) {
            case RECT:
              title = "Rechteck";
              drawCol = document.querySelector(
                ".draw-col." + event_id + "-col"
              );
              drawCol.style.display = "block";
              rootImg = event_id + ".png";
              imgDrawText = RECT_SCOPE_TEXT;
              resetInputNumberFields(
                document.querySelectorAll(".rectangle-col input")
              );
              break;
            case TRI:
              title = "Dreieck";
              drawCol = document.querySelector(
                ".draw-col." + event_id + "-col"
              );
              drawCol.style.display = "block";
              rootImg = event_id + ".png";
              imgDrawText = TRI_SCOPE_TEXT;
              resetInputNumberFields(
                document.querySelectorAll(".triangle-col input")
              );
              break;
            case CIR:
              title = "Kreis";
              drawCol = document.querySelector(
                ".draw-col." + event_id + "-col"
              );
              drawCol.style.display = "block";
              rootImg = event_id + ".png";
              imgDrawText = CIR_SCOPE_TEXT;
              resetInputNumberFields(
                document.querySelectorAll(".circle-col input")
              );
              break;
          }

          setTitle(title, imgDrawText);

          if (rootImg) {
            drawImg = document.querySelector(".draw-img");
            if (drawImg != null) {
              drawImg.src = rootImg;
              toggleDrawImage("block");
            }
          }
        }
        ///
        /// Calculate with the given option
        ///
        function calc() {
          log("Calculation");
          // get current selection
          let selectedOption = document.querySelector(".radio-top :checked");
          let selectedCalculation = document.querySelector(
            ".radio-calculation :checked"
          );
          switch (selectedOption.id) {
            case RECT:
              calculateRectangle(selectedCalculation);
              break;
            case TRI:
              calculateTriangle(selectedCalculation);
              break;
            case CIR:
              calculateCircle(selectedCalculation);
              break;
            default:
              return;
          }
        }
        function setResultToField(field, result = 0) {
          if (field != null) {
            log("result=" + result);
            field.value = result;
          }
        }
        /**
         * calculate the rectangle with the given option
         */
        function calculateRectangle(option) {
          let s_option = option.id || SCOPE;
          log("Calculation Reactangle with option " + option.id);
          let a = document.querySelector(
            ".rectangle-col input.rectangle-col-a"
          ).value;
          let b = document.querySelector(
            ".rectangle-col input.rectangle-col-b"
          ).value;
          let field = document.querySelector(
            ".rectangle-col input.rectangle-col-result"
          );
          if (s_option == SCOPE) {
            const result = Number(a * b);
            setResultToField(field, result);
          } else {
            const result = Number(2 * (Number(a) + Number(b)));
            setResultToField(field, result);
          }
        }
        /**
         * calculate triangle
         */
        function calculateTriangle(option) {
          let s_option = option.id || SCOPE;
          log("Calculation Triangle with option " + option.id);
          let a = document.querySelector(
            ".triangle-col input.triangle-col-a"
          ).value;
          let b = document.querySelector(
            ".triangle-col input.triangle-col-b"
          ).value;
          let field = document.querySelector(
            ".triangle-col input.triangle-col-result"
          );
          if (s_option == SCOPE) {
            const result = Number((a * b) / 2);
            setResultToField(field, result);
          } else {
            const c = Math.sqrt(Math.pow(a, 2) + Math.pow(b, 2));
            const result = Number(a) + Number(b) + Number(c);
            setResultToField(field, result);
          }
        }
        /**
         * calcualte circle
         */
        function calculateCircle(option) {
          let s_option = option.id || SCOPE;
          log("Calculation Circle with option " + option.id);
          let r = document.querySelector(
            ".circle-col input.circle-col-r"
          ).value;
          let field = document.querySelector(
            ".circle-col input.circle-col-result"
          );
          if (s_option == SCOPE) {
            const result = Math.PI * Math.pow(r, 2);
            setResultToField(field, result);
          } else {
            const result = Math.PI * Number(r) * 2;
            setResultToField(field, result);
          }
        }
      </script>
    </div>
  </body>
</html>
